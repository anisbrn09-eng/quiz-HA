const BANK = [
  {
    "q": "Pourquoi la vidéo montre-t-elle des statues brisées ?",
    "options": [
      "Pour montrer que les ouvriers étaient violents",
      "Les pillards ont essayé de supprimer le pouvoir symbolique du roi",
      "Parce que l’Égypte manque de pierre",
      "Parce que c’était la tradition"
    ],
    "answer": 1
  },
  {
    "q": "Que montre la précision des blocs ?",
    "options": [
      "Que c’est du hasard",
      "Que les ouvriers étaient indisciplinés",
      "Qu’il existait une organisation et des spécialistes",
      "Que tout était improvisé"
    ],
    "answer": 2
  },
  {
    "q": "Quel est le rôle du rituel Heb-Sed ?",
    "options": [
      "Tester les architectes",
      "Honorer les animaux sacrés",
      "Célébrer le début des récoltes",
      "Renouveler symboliquement le pouvoir du pharaon en prouvant sa force"
    ],
    "answer": 3
  },
  {
    "q": "Que représente la construction monumentale pour l’Égypte ?",
    "options": [
      "Un défi militaire",
      "Un moyen de laisser une trace éternelle du pouvoir royal",
      "Un concours d’architectes",
      "Un travail d’esclaves payés"
    ],
    "answer": 1
  },
  {
    "q": "Quelle est l’innovation principale apportée par Imhotep ?",
    "options": [
      "Il invente les pyramides lisses de Gizeh",
      "Il construit pour la première fois un monument monumental en pierre",
      "Il découvre l’électricité",
      "Il crée les hiéroglyphes"
    ],
    "answer": 1
  },
  {
    "q": "Comment les archéologues savent-ils que des cérémonies avaient lieu ?",
    "options": [
      "Grâce aux films d’époque",
      "Grâce aux objets rituels et aux inscriptions retrouvées",
      "Grâce aux fossiles",
      "Grâce aux traces d’eau"
    ],
    "answer": 1
  },
  {
    "q": "Comment les Égyptiens transportaient-ils les blocs ?",
    "options": [
      "Avec des hélicoptères",
      "Avec des roues",
      "Avec des traîneaux et des rampes",
      "Avec des bateaux volants"
    ],
    "answer": 2
  },
  {
    "q": "Quel est le message final du documentaire ?",
    "options": [
      "Les Égyptiens copiaient les Grecs",
      "La pyramide de Gizeh est un accident",
      "Avec Djéser commence l’architecture monumentale en pierre et le rêve d’éternité",
      "Les pyramides servaient à faire du commerce"
    ],
    "answer": 2
  },
  {
    "q": "Pourquoi la pyramide est-elle placée dans une nécropole ?",
    "options": [
      "Parce qu’il n’y avait plus de place ailleurs",
      "Pour avoir une vue sur le Nil",
      "Pour tenir le peuple éloigné",
      "Parce que c’est le domaine des morts (ville des morts)"
    ],
    "answer": 3
  },
  {
    "q": "Comment explique-t-on que les Égyptiens aient construit aussi grand ?",
    "options": [
      "Pour rivaliser avec la Grèce",
      "Pour créer une ville entière à Saqqarah",
      "Pour glorifier le roi et son passage dans l’éternité",
      "Pour stocker les céréales"
    ],
    "answer": 2
  },
  {
    "q": "Que signifie la phrase « faire durer le pouvoir au-delà de la mort » ?",
    "options": [
      "Faire des films",
      "Continuer à gouverner une fois mort grâce aux rituels et à l’architecture",
      "Faire des enfants",
      "Se battre contre les dieux"
    ],
    "answer": 1
  },
  {
    "q": "Pourquoi le pharaon doit-il courir durant le Heb-Sed ?",
    "options": [
      "Pour battre un record",
      "Pour divertir la foule",
      "Pour prouver qu’il est encore capable de gouverner physiquement",
      "Parce que les prêtres l’exigent"
    ],
    "answer": 2
  },
  {
    "q": "Que trouve-t-on sous la pyramide de Djéser ?",
    "options": [
      "Une seule pièce vide",
      "Un réseau complexe de galeries et de magasins",
      "Un temple secret",
      "Une chambre d’or"
    ],
    "answer": 1
  },
  {
    "q": "Pourquoi le choix de la pierre est important ?",
    "options": [
      "Parce qu’elle est plus rapide à transporter",
      "Parce qu’elle symbolise l’éternité et dure dans le temps",
      "Parce qu’elle coûte moins cher",
      "Parce qu’elle est utilisée dans tout le pays"
    ],
    "answer": 1
  },
  {
    "q": "Pourquoi Imhotep est important dans l’histoire du monde ?",
    "options": [
      "Il invente l’agriculture",
      "Il invente le concept d’architecture monumentale en pierre",
      "Il crée la médecine moderne",
      "Il voyage en Europe"
    ],
    "answer": 1
  },
  {
    "q": "À quoi servaient les magasins sous le complexe ?",
    "options": [
      "À cacher des trésors des pillards",
      "À stocker les offrandes et les objets nécessaires au roi dans l’au-delà",
      "À enterrer les ouvriers",
      "À faire des rituels d’embaumement"
    ],
    "answer": 1
  },
  {
    "q": "Pourquoi Imhotep est-il divinisé plus tard ?",
    "options": [
      "Parce qu’il était riche",
      "Parce qu’il a découvert l’Amérique",
      "Parce qu’il était considéré comme un sage et un savant exceptionnel",
      "Parce qu’il a combattu dans des guerres"
    ],
    "answer": 2
  },
  {
    "q": "Pourquoi la vidéo parle-t-elle d’un « chantier gigantesque » ?",
    "options": [
      "C’est un effet de style",
      "Pour augmenter le tourisme",
      "Parce que tout un pays mobilisait ses ressources pour un seul projet",
      "Parce qu’ils construisaient 10 pyramides en même temps"
    ],
    "answer": 2
  },
  {
    "q": "Pourquoi la pyramide de Djéser est-elle à degrés ?",
    "options": [
      "Pour imiter les montagnes",
      "Elle est construite par empilement de plusieurs mastabas",
      "C’est une erreur de construction",
      "Pour servir d’escalier à la population"
    ],
    "answer": 1
  },
  {
    "q": "Pourquoi les archéologues trouvent-ils des objets miniatures ?",
    "options": [
      "Ce sont des jouets",
      "Ils représentent symboliquement des objets réels pour l’au-delà",
      "Ils étaient vendus au marché",
      "Ils servaient de monnaie"
    ],
    "answer": 1
  },
  {
    "q": "Qui est Imhotep selon la vidéo ?",
    "options": [
      "Un prêtre chargé des cérémonies uniquement",
      "L’architecte et conseiller du pharaon Djéser",
      "Un soldat influent sous Ramsès II",
      "Un explorateur étranger"
    ],
    "answer": 1
  },
  {
    "q": "Que symbolise la salle d’audience reconstituée ?",
    "options": [
      "Une salle de banquet",
      "Un théâtre",
      "La cour royale où le roi exerce son pouvoir",
      "Un marché couvert"
    ],
    "answer": 2
  },
  {
    "q": "Pourquoi construire en hauteur était symbolique ?",
    "options": [
      "Pour faire peur",
      "Pour rapprocher le roi des dieux",
      "Pour observer les étoiles",
      "Parce que c’était à la mode"
    ],
    "answer": 1
  },
  {
    "q": "Quel symbole revient souvent dans l’architecture de Djéser ?",
    "options": [
      "Le cercle",
      "La reproduction du palais royal en pierre",
      "Le chiffre 3",
      "Les étoiles"
    ],
    "answer": 1
  },
  {
    "q": "Pourquoi la pyramide de Djéser est un prototype ?",
    "options": [
      "C’est la première tentative de construction monumentale en hauteur",
      "Elle est faite de sable",
      "Elle n’a jamais été terminée",
      "Elle n’a pas de tombe"
    ],
    "answer": 0
  },
  {
    "q": "Pourquoi la chambre funéraire est-elle protégée par des galeries ?",
    "options": [
      "Pour créer un labyrinthe décoratif",
      "Pour empêcher l’accès aux pillards et protéger le corps du roi",
      "Pour abriter les animaux sacrés",
      "Pour organiser des cérémonies secrètes"
    ],
    "answer": 1
  },
  {
    "q": "Quel rôle joue l’architecte dans le pouvoir du pharaon ?",
    "options": [
      "Aucun rôle",
      "Rendre visible le pouvoir du roi par la construction",
      "Organiser l’armée",
      "Décider des impôts"
    ],
    "answer": 1
  },
  {
    "q": "Pourquoi la construction de Djéser demande des spécialistes ?",
    "options": [
      "Parce que la pierre est facile à couper",
      "C’est un petit chantier",
      "La taille de la pierre exige précision et savoir-faire",
      "Il fallait un artisan par bloc"
    ],
    "answer": 2
  },
  {
    "q": "Quel était l’objectif final de Djéser ?",
    "options": [
      "Créer un palais habitable",
      "Assurer sa vie éternelle et la continuité de son pouvoir après la mort",
      "Faire un record de hauteur",
      "Construire un musée"
    ],
    "answer": 1
  },
  {
    "q": "La pyramide de Djéser est-elle plus vieille que les pyramides de Gizeh ?",
    "options": [
      "Non, elle est plus récente",
      "Oui, elle est la première",
      "Elles ont été construites en même temps",
      "Elle date de l’époque romaine"
    ],
    "answer": 1
  }
];

// choose 20 random questions
function pickRandom(arr, n){
  const copy = [...arr];
  for(let i=copy.length-1;i>0;i--){ const j = Math.floor(Math.random()*(i+1)); [copy[i],copy[j]]=[copy[j],copy[i]]; }
  return copy.slice(0,n);
}

const QUESTIONS = pickRandom(BANK, 20);
let current = 0;
let score = 0;
const quizArea = document.getElementById('quizArea');
const progress = document.getElementById('progress');
const endBtn = document.getElementById('endBtn');

function renderQuestion(idx){
  const q = QUESTIONS[idx];
  quizArea.innerHTML = '';
  const card = document.createElement('div'); card.className='qcard';
  const question = document.createElement('div'); question.className='question'; question.innerText = (idx+1)+'. '+q.q;
  const answers = document.createElement('div'); answers.className='answers';
  q.options.forEach((opt,i)=>{
    const b = document.createElement('button'); b.className='btnAnswer'; b.innerText = opt;
    b.addEventListener('click', ()=>{
      // mark immediate
      if(i === q.answer){ score += 1; b.classList.add('correct'); }
      else{ b.classList.add('wrong'); }
      // show correct answer briefly? per choice 2 we move directly to next
      // disable all buttons immediately
      const all = answers.querySelectorAll('button'); all.forEach(btn=> btn.disabled = true);
      // immediately go to next question after tiny timeout to allow color render
      setTimeout(()=>{ current += 1; if(current < QUESTIONS.length){ updateProgress(); renderQuestion(current); } else { showResult(); } }, 200);
    });
    answers.appendChild(b);
  });
  card.appendChild(question); card.appendChild(answers);
  quizArea.appendChild(card);
  updateProgress();
}

function updateProgress(){
  progress.innerText = (current+1) + ' / ' + QUESTIONS.length;
}

function showResult(){
  quizArea.innerHTML = '';
  const r = document.createElement('div'); r.className='qcard';
  const title = document.createElement('div'); title.className='result'; title.innerText = 'Test terminé';
  const scoreEl = document.createElement('div'); scoreEl.className='subtitle'; scoreEl.innerText = 'Score: ' + score + ' / ' + QUESTIONS.length;
  r.appendChild(title); r.appendChild(scoreEl);
  quizArea.appendChild(r);
  endBtn.classList.remove('hidden');
}

endBtn.addEventListener('click', ()=>{ location.reload(); });

// start
document.addEventListener('DOMContentLoaded', ()=>{
  renderQuestion(current);
});
